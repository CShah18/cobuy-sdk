"use strict";const c={config:{apiBaseUrl:"",allowImpression:!0},init(e={}){this.config={...this.config,...e},this.loadAds()},async loadAds(){const e=document.querySelectorAll(".cobuy-ad");e.length&&e.forEach(async t=>{const n=t.dataset.campaign||"unknown",o=t.dataset.brand||"",r=t.dataset.width||"300",s=t.dataset.height||"250",i=t.dataset.apiBase||this.config.apiBaseUrl,d=t.dataset.clickTracker;if(!i){console.error("[CoBuySDK] Missing apiBase in ad tag");return}try{const a=await this.fetchCreative(i,n);if(!a||!a.url){console.error("[CoBuySDK] No creative returned from API");return}this.renderCreative(t,a.url,r,s,d),this.config.allowImpression&&this.emitImpression({apiBase:i,campaignId:n,brand:o,width:r,height:s})}catch(a){console.error("[CoBuySDK] Error loading creative:",a)}})},async fetchCreative(e,t){const n=`${e}/api/v1/creative?cid=${encodeURIComponent(t)}&cb=${Date.now()}`,o=await fetch(n);if(!o.ok)throw new Error(`Creative fetch failed: ${o.status}`);return o.json()},renderCreative(e,t,n,o,r){e.innerHTML="",e.style.position="relative",e.style.display="inline-block",e.style.width=`${n}px`,e.style.height=`${o}px`;const s=document.createElement("iframe");if(s.src=t,s.width=n,s.height=o,s.frameBorder="0",s.scrolling="no",s.style.border="none",e.appendChild(s),r){const i=document.createElement("a");i.href=r,i.target="_blank",i.rel="noopener",Object.assign(i.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%",textDecoration:"none"}),i.addEventListener("click",()=>this.emitEvent("click",{campaign_id:campaignId})),e.appendChild(i)}},emitImpression({apiBase:e,campaignId:t,brand:n,width:o,height:r}){const s=`${e}/imp?cid=${t}&crid=${o}x${r}&brand=${encodeURIComponent(n)}&cb=${Date.now()}`,i=new Image(1,1);i.src=s,i.style="position:absolute;left:-9999px;top:-9999px;",document.body.appendChild(i),console.log("[CoBuySDK] Impression fired:",s)},emitEvent(e,t={}){const n=`${this.config.apiBaseUrl}/events`,o={event_type:e,timestamp:new Date().toISOString(),...t};fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(r=>console.error("[CoBuySDK] Event error:",r.message))},createShareLinks(e,t={}){const n=this.addUTMParams(e,t),o=encodeURIComponent(n);return{whatsapp:`https://wa.me/?text=${o}`,sms:`sms:?body=${o}`,copy:n}},addUTMParams(e,t={}){const n=new URLSearchParams(t).toString();if(!n)return e;const o=e.includes("?")?"&":"?";return`${e}${o}${n}`}};typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>c.init()):c.init(),window.CoBuySDK=c);module.exports=c;
